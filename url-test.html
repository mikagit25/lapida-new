<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç URL —Å–∏—Å—Ç–µ–º—ã Lapida.one</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .url-test {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
            margin: 10px 0;
        }
        .success { color: #28a745; }
        .info { color: #17a2b8; }
        .warning { color: #ffc107; }
        h1 { color: #333; text-align: center; }
        h2 { color: #555; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ –¢–µ—Å—Ç URL —Å–∏—Å—Ç–µ–º—ã Lapida.one</h1>
        
        <div class="test-section">
            <h2>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏</h2>
            <div class="url-test">
                <strong>–¢–µ–∫—É—â–∏–π —Ö–æ—Å—Ç:</strong> <span id="currentHost"></span><br>
                <strong>–¢–µ–∫—É—â–∏–π –ø–æ—Ä—Ç:</strong> <span id="currentPort"></span><br>
                <strong>–ü—Ä–æ—Ç–æ–∫–æ–ª:</strong> <span id="currentProtocol"></span><br>
                <strong>–ü–æ–ª–Ω—ã–π URL:</strong> <span id="fullUrl"></span>
            </div>
        </div>

        <div class="test-section">
            <h2>–¢–µ—Å—Ç–æ–≤—ã–µ URL –¥–ª—è –º–µ–º–æ—Ä–∏–∞–ª–æ–≤</h2>
            <div id="urlTests"></div>
        </div>

        <div class="test-section">
            <h2>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–º–æ—Ä–∏–∞–ª–æ–≤</h2>
            <div id="memorialTests"></div>
            <button onclick="testMemorials()" style="padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ–º–æ—Ä–∏–∞–ª–æ–≤
            </button>
        </div>
    </div>

    <script>
        // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
        document.getElementById('currentHost').textContent = window.location.hostname;
        document.getElementById('currentPort').textContent = window.location.port || '(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)';
        document.getElementById('currentProtocol').textContent = window.location.protocol;
        document.getElementById('fullUrl').textContent = window.location.href;

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –º–µ–º–æ—Ä–∏–∞–ª–æ–≤
        const testMemorials = [
            {
                fullName: 'test test',
                shareUrl: 'test-test-1753888346336',
                customSlug: 'test-test'
            },
            {
                fullName: '–µ—Ä–∫ —Ü–∫–µ',
                shareUrl: '–µ—Ä–∫-—Ü–∫–µ-1753879618554',
                customSlug: 'erk-tske'
            },
            {
                fullName: 'test5 test5',
                shareUrl: 'test5-test5-1754227690887',
                customSlug: 'test5-test5'
            }
        ];

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ URL (–∫–æ–ø–∏—è –∏–∑ utils/memorialUrl.js)
        const getMemorialUrl = (memorial) => {
            if (memorial.customSlug) {
                return `/${memorial.customSlug}`;
            }
            return `/memorial/${memorial.shareUrl || memorial._id}`;
        };

        const getMemorialShareUrl = (memorial) => {
            const currentHost = window.location.hostname;
            const isDevelopment = currentHost === 'localhost';
            const isProduction = currentHost === 'lapida.one';
            
            if (memorial.customSlug && (isProduction || import.meta?.env?.PROD)) {
                return `https://lapida.one/${memorial.customSlug}`;
            } else if (memorial.customSlug && !isDevelopment) {
                return `${window.location.origin}/${memorial.customSlug}`;
            } else {
                return `${window.location.origin}/memorial/${memorial.shareUrl || memorial._id}`;
            }
        };

        const getMemorialDisplayUrl = (memorial) => {
            const currentHost = window.location.hostname;
            const isDevelopment = currentHost === 'localhost';
            const isProduction = currentHost === 'lapida.one';
            
            if (memorial.customSlug && (isProduction || import.meta?.env?.PROD)) {
                return `lapida.one/${memorial.customSlug}`;
            } else if (memorial.customSlug && !isDevelopment) {
                return `${currentHost}/${memorial.customSlug}`;
            } else {
                return `${window.location.origin}/memorial/${memorial.shareUrl || memorial._id}`;
            }
        };

        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–µ—Å—Ç—ã URL
        const urlTestsContainer = document.getElementById('urlTests');
        testMemorials.forEach((memorial, index) => {
            const div = document.createElement('div');
            div.className = 'url-test';
            
            const routerUrl = getMemorialUrl(memorial);
            const shareUrl = getMemorialShareUrl(memorial);
            const displayUrl = getMemorialDisplayUrl(memorial);
            
            div.innerHTML = `
                <strong>–ú–µ–º–æ—Ä–∏–∞–ª ${index + 1}: ${memorial.fullName}</strong><br>
                <span class="info">Router URL:</span> ${routerUrl}<br>
                <span class="info">Share URL:</span> ${shareUrl}<br>
                <span class="info">Display URL:</span> ${displayUrl}<br>
                <a href="${routerUrl}" target="_blank" style="color: #007bff;">‚Üí –û—Ç–∫—Ä—ã—Ç—å –º–µ–º–æ—Ä–∏–∞–ª</a>
            `;
            
            urlTestsContainer.appendChild(div);
        });

        // –§—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ–º–æ—Ä–∏–∞–ª–æ–≤
        async function testMemorials() {
            const testContainer = document.getElementById('memorialTests');
            testContainer.innerHTML = '<p>–¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–µ–º–æ—Ä–∏–∞–ª–æ–≤...</p>';
            
            const results = [];
            
            for (const memorial of testMemorials) {
                const routerUrl = getMemorialUrl(memorial);
                const fullUrl = `${window.location.origin}${routerUrl}`;
                
                try {
                    const response = await fetch(fullUrl);
                    const status = response.ok ? 'success' : 'warning';
                    const statusText = response.ok ? '‚úÖ –î–æ—Å—Ç—É–ø–µ–Ω' : `‚ö†Ô∏è ${response.status} ${response.statusText}`;
                    
                    results.push({
                        memorial: memorial.fullName,
                        url: routerUrl,
                        status: status,
                        statusText: statusText
                    });
                } catch (error) {
                    results.push({
                        memorial: memorial.fullName,
                        url: routerUrl,
                        status: 'error',
                        statusText: `‚ùå –û—à–∏–±–∫–∞: ${error.message}`
                    });
                }
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            testContainer.innerHTML = results.map(result => `
                <div class="url-test">
                    <strong>${result.memorial}</strong><br>
                    <span class="info">URL:</span> ${result.url}<br>
                    <span class="${result.status}">${result.statusText}</span>
                </div>
            `).join('');
        }

        console.log('üéØ –¢–µ—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        console.log('üåê –¢–µ–∫—É—â–µ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:', {
            host: window.location.hostname,
            port: window.location.port,
            protocol: window.location.protocol,
            isDevelopment: window.location.hostname === 'localhost',
            isProduction: window.location.hostname === 'lapida.one'
        });
    </script>
</body>
</html>
